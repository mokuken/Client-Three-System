<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        height: 100vh;
        background-image: url("{{ url_for('static', filename='images/admin-bg.png') }}");
        background-size: cover;
        background-position: center;
        background-attachment: fixed; /* keeps it frozen while scrolling */
    }
    .navbar {
        background-color: #333;
        color: white;
        height: 10vh;
        padding: 10px 20px;
        position: sticky;
        top: 0;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .brand {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .user {
        display: flex;
        align-items: center;
    }

    .main {
        display: flex;
        justify-content: center;
        padding: 20px;
        height: 90vh;
        gap: 20px;
    }

    .left {
        width: 20%;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .left a {
        padding: 15px 20px;
        text-decoration: none;
        background-color: white;
        color: black;
        border-radius: 15px;
    }

    .left a.active, .left a:hover {
        background-color: grey;
        color: white;
        font-weight: bold;
    }

    .right {
        width: 80%;
        height: 100%;
    }
    .position-list {
        background: white;
        height: 100%;
        border-radius: 10px;
        padding: 20px;
        overflow-y: auto;
    }
    /* Modal styles */
    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
    .modal[aria-hidden="false"] { display:flex; }
    .modal-overlay { position:absolute; inset:0; background: rgba(0,0,0,0.45); }
    .modal-panel { position: relative; background: #fff; max-width:720px; width:100%; border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.2); z-index:2; padding:18px 20px; max-height:90vh; overflow-y:auto; }
    .modal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .modal-header h2 { font-size:1.1rem; }
    .close-btn { background:transparent; border:none; font-size:1.6rem; cursor:pointer; line-height:1; }
    .modal-form .form-row { margin-bottom:12px; display:flex; flex-direction:column; }
    .modal-form label { margin-bottom:6px; font-weight:600; font-size:0.95rem; }
    .modal-form input[type="text"], .modal-form input[type="number"], .modal-form textarea, .modal-form select { padding:8px 10px; border-radius:6px; border:1px solid #ccc; font-size:0.95rem; }
    .modal-form .split { display:flex; gap:12px; }
    .modal-form .split > div { flex:1; }
    .form-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:8px; }
    .btn { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
    .btn-primary { background:#007bff; color:white; }
    .btn-secondary { background:#6c757d; color:white; }
    /* compact actions column */
    .actions-col { width: 140px; white-space: nowrap; text-align: center; }
    .actions-col a { display: inline-block; vertical-align: middle; }

    /* Shared table styles */
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table thead tr { background-color: #f4f4f4; }
    .data-table th, .data-table td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
    .data-table td { border-bottom: 1px solid #eee; }
    @media (max-width:640px) { .left { display:none; } .modal-panel { padding:12px; margin:0 8px; } }
</style>
<body>
    <div class="navbar">
        <div class="brand">
            <img src="{{ url_for('static', filename='images/logo.png') }}" style="width: 50px;" alt="Logo" class="logo">
            <div class="brand-name">
                <h3>Vicente Andaya Senior National High School</h3>
                <h4>Online Voting System</h4>
            </div>
        </div>
        <div class="user">
            <img src="{{ url_for('static', filename='images/profile.png') }}" style="width: 30px; border-radius: 50%;" alt="User" class="user-icon">
            <span class="username" style="margin-left: 10px; color: white;">John Doe</span>
            <div class="logout">
                <button style="padding: 10px 15px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 15px;">
                    <img src="{{ url_for('static', filename='images/logout.png') }}" style="width: 16px; vertical-align: middle; margin-right: 5px;" alt="Logout Icon">
                    Logout
                </button>
            </div>
        </div>
    </div>
    <div class="main">
        <div class="left">
            <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
            <a href="{{ url_for('admin_voters') }}">Voters</a>
            <a href="{{ url_for('admin_elections') }}">Election</a>
            <a href="{{ url_for('admin_candidates') }}">Candidates</a>
            <a href="{{ url_for('admin_position') }}" class="active">Position</a>
            <a href="#">View Results</a>
            <a href="#">Printed Result</a>
        </div>
        <div class="right">
            <div class="position-list">
                <div style="display:flex; justify-content: flex-end; margin-bottom: 12px;">
                    <button id="openPositionModal" style="padding: 8px 12px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer;">Add Position</button>
                </div>
                <!-- Add Position Modal -->
                <div id="positionModal" class="modal" aria-hidden="true">
                    <div class="modal-overlay" data-close></div>
                    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="positionModalTitle">
                        <header class="modal-header">
                            <h2 id="positionModalTitle">Create New Position</h2>
                            <button class="close-btn" id="closePositionModal" aria-label="Close modal">&times;</button>
                        </header>
                        <form id="positionForm" method="post" action="{{ url_for('admin_position') }}" class="modal-form">
                            <input type="hidden" id="position_id" name="position_id" value="">
                            <div class="form-row">
                                <label for="position_title">Position Title</label>
                                <input type="text" id="position_title" name="position_title" required placeholder="e.g., President">
                            </div>
                            <div class="form-row">
                                <label for="position_description">Description</label>
                                <textarea id="position_description" name="position_description" rows="3" placeholder="Role responsibilities (optional)"></textarea>
                            </div>
                            <div class="form-row split">
                                <div>
                                    <label for="max_winners">Maximum Number of Winners</label>
                                    <input type="number" id="max_winners" name="max_winners" min="1" value="1" required>
                                </div>
                                <div>
                                    <label for="election_select">Election</label>
                                    <select id="election_select" name="election_select">
                                        <option value="">-- Select Election --</option>
                                        {% for el in elections %}
                                            <option value="{{ el.id }}">{{ el.title }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" id="cancelPosition">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save Position</button>
                            </div>
                        </form>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Position Name</th>
                            <th>Position Number</th>
                            <th class="actions-col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if positions and positions|length > 0 %}
                            {% for p in positions %}
                                <tr>
                                    <td>{{ p.title }}</td>
                                    <td>{{ p.max_winners }}</td>
                                    <td class="actions-col">
                                        <a href="#" class="btn-edit" data-id="{{ p.id }}" data-title="{{ p.title|e }}" data-description="{{ p.description|e if p.description else '' }}" data-max_winners="{{ p.max_winners }}" data-election="{{ p.election_id or '' }}" style="padding:6px 10px; background:#ffc107; color:#000; text-decoration:none; border-radius:5px; margin-right:6px;">Edit</a>
                                        <a href="#" class="btn-delete" data-id="{{ p.id }}" style="padding:6px 10px; background:#dc3545; color:#fff; text-decoration:none; border-radius:5px;">Delete</a>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr><td colspan="3">No positions defined.</td></tr>
                        {% endif %}
                    </tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
<script>
    (function () {
        const openBtn = document.getElementById('openPositionModal');
        const modal = document.getElementById('positionModal');
        const closeBtn = document.getElementById('closePositionModal');
        const cancelBtn = document.getElementById('cancelPosition');
        const overlay = document.querySelector('#positionModal .modal-overlay');
        const form = document.getElementById('positionForm');

        function showModal() {
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            setTimeout(() => document.getElementById('position_title').focus(), 50);
        }

        function hideModal() {
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
            form && form.reset();
        }

        openBtn && openBtn.addEventListener('click', showModal);
        closeBtn && closeBtn.addEventListener('click', hideModal);
        cancelBtn && cancelBtn.addEventListener('click', hideModal);
        overlay && overlay.addEventListener('click', hideModal);

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && modal.getAttribute('aria-hidden') === 'false') hideModal();
        });

        const positionIdInput = document.createElement('input');
        // we already have a hidden input in the form; ensure we reference it
        const positionIdField = document.getElementById('position_id');

        form && form.addEventListener('submit', function (e) {
            const maxWinners = parseInt(document.getElementById('max_winners').value, 10);
            if (isNaN(maxWinners) || maxWinners < 1) {
                e.preventDefault(); alert('Maximum number of winners must be 1 or more.'); return false;
            }
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Saving...'; }
        });

        // Edit buttons: populate modal
        document.querySelectorAll('.btn-edit').forEach(function (btn) {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                const id = this.getAttribute('data-id');
                const title = this.getAttribute('data-title') || '';
                const description = this.getAttribute('data-description') || '';
                const max_winners = this.getAttribute('data-max_winners') || '1';
                const election = this.getAttribute('data-election') || '';

                if (positionIdField) positionIdField.value = id;
                document.getElementById('position_title').value = title;
                document.getElementById('position_description').value = description;
                document.getElementById('max_winners').value = max_winners;
                document.getElementById('election_select').value = election;
                document.getElementById('positionModalTitle').textContent = 'Edit Position';
                const submitBtn = form.querySelector('button[type="submit"]');
                if (submitBtn) submitBtn.textContent = 'Save Changes';
                showModal();
            });
        });

        // Delete modal
        const deleteModal = document.createElement('div');
        deleteModal.innerHTML = `
        <div id="deletePositionModal" class="modal" aria-hidden="true">
            <div class="modal-overlay" data-close-delete></div>
            <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="deletePositionTitle">
                <header class="modal-header">
                    <h2 id="deletePositionTitle">Confirm Delete</h2>
                    <button class="close-btn" id="closeDeletePositionModal">&times;</button>
                </header>
                <p>Are you sure you want to delete this position? This action cannot be undone.</p>
                <form id="deletePositionForm" method="post" action="{{ url_for('admin_delete_position') }}" style="margin-top:12px; display:flex; justify-content:flex-end; gap:8px;">
                    <input type="hidden" id="delete_position_id" name="position_id" value="">
                    <button type="button" class="btn btn-secondary" id="cancelDeletePosition">Cancel</button>
                    <button type="submit" class="btn" style="background:#dc3545; color:#fff;">Delete</button>
                </form>
            </div>
        </div>`;
        document.body.appendChild(deleteModal);
        const deleteModalEl = document.getElementById('deletePositionModal');
        const deleteOverlay = deleteModalEl && deleteModalEl.querySelector('.modal-overlay');
        const closeDeleteBtn = document.getElementById('closeDeletePositionModal');
        const cancelDeleteBtn = document.getElementById('cancelDeletePosition');
        const deleteIdInput = document.getElementById('delete_position_id');

        document.querySelectorAll('.btn-delete').forEach(function (btn) {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                const id = this.getAttribute('data-id');
                if (!id) return;
                deleteIdInput.value = id;
                deleteModalEl.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';
            });
        });

        deleteOverlay && deleteOverlay.addEventListener('click', function () { deleteModalEl.setAttribute('aria-hidden', 'true'); document.body.style.overflow = ''; deleteIdInput.value = ''; });
        closeDeleteBtn && closeDeleteBtn.addEventListener('click', function () { deleteModalEl.setAttribute('aria-hidden', 'true'); document.body.style.overflow = ''; deleteIdInput.value = ''; });
        cancelDeleteBtn && cancelDeleteBtn.addEventListener('click', function () { deleteModalEl.setAttribute('aria-hidden', 'true'); document.body.style.overflow = ''; deleteIdInput.value = ''; });
    })();
</script>
</html>