<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        height: 100vh;
        background-image: url("{{ url_for('static', filename='images/admin-bg.png') }}");
        background-size: cover;
        background-position: center;
        background-attachment: fixed; /* keeps it frozen while scrolling */
    }
    /* Navbar styles moved to partial: templates/partials/admin_navbar.html */

    .main {
        display: flex;
        justify-content: center;
        padding: 20px;
        height: 90vh;
        gap: 20px;
    }

    .left {
        width: 20%;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .left a {
        padding: 15px 20px;
        text-decoration: none;
        background-color: white;
        color: black;
        border-radius: 15px;
    }

    .left a.active, .left a:hover {
        background-color: grey;
        color: white;
        font-weight: bold;
    }

    .right {
        width: 80%;
        height: 100%;
    }
    .election-list {
        background: white;
        height: 100%;
        border-radius: 10px;
        padding: 20px;
        overflow-y: auto;
    }
    /* Modal styles */
    .modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        padding: 20px;
    }
    .modal[aria-hidden="false"] {
        display: flex;
    }
    .modal-overlay {
        position: absolute;
        inset: 0;
        background: rgba(0,0,0,0.45);
    }
    .modal-panel {
        position: relative;
        background: #fff;
        max-width: 720px;
        width: 100%;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        z-index: 2;
        padding: 18px 20px;
        max-height: 90vh;
        overflow-y: auto;
    }
    .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
    }
    .modal-header h2 { font-size: 1.1rem; }
    .close-btn {
        background: transparent;
        border: none;
        font-size: 1.6rem;
        cursor: pointer;
        line-height: 1;
    }
    .modal-form .form-row { margin-bottom: 12px; display: flex; flex-direction: column; }
    .modal-form label { margin-bottom: 6px; font-weight: 600; font-size: 0.95rem; }
    .modal-form input[type="text"], .modal-form input[type="date"], .modal-form textarea, .modal-form select {
        padding: 8px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 0.95rem;
        width: 100%;
    }
    .modal-form textarea { resize: vertical; }
    .modal-form .split { display: flex; gap: 12px; }
    .modal-form .split > div { flex: 1; }
    .form-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 8px; }
    .btn { padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; }
    .btn-primary { background: #007bff; color: white; }
    .btn-secondary { background: #6c757d; color: white; }

    /* Responsive adjustments */
    @media (max-width: 640px) {
        .left { display: none; }
        .modal-panel { padding: 12px; margin: 0 8px; }
        .modal-form label { font-size: 0.9rem; }
    }
    /* compact actions column */
    .actions-col { width: 140px; white-space: nowrap; text-align: center; }
    .actions-col a { display: inline-block; vertical-align: middle; }

    /* Shared table styles */
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table thead tr { background-color: #f4f4f4; }
    .data-table th, .data-table td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
    .data-table td { border-bottom: 1px solid #eee; }
</style>
<body>
    {% include 'partials/admin_navbar.html' %}
    <div class="main">
        <div class="left">
            <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
            <a href="{{ url_for('admin_voters') }}">Voters</a>
            <a href="{{ url_for('admin_elections') }}" class="active">Election</a>
            <a href="{{ url_for('admin_candidates') }}">Candidates</a>
            <a href="{{ url_for('admin_position') }}">Position</a>
            <a href="#">View Results</a>
            <a href="#">Printed Result</a>
        </div>
        <div class="right">
            <div class="election-list">
                <div style="display:flex; justify-content: flex-end; margin-bottom: 12px;">
                    <button id="openModalBtn" style="padding: 8px 12px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer;">Add Election</button>
                </div>
                <!-- Create Election Modal -->
                <div id="electionModal" class="modal" aria-hidden="true">
                    <div class="modal-overlay" data-close></div>
                    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
                        <header class="modal-header">
                            <h2 id="modalTitle">Create New Election</h2>
                            <button class="close-btn" id="closeModalBtn" aria-label="Close modal">&times;</button>
                        </header>
                        <form id="electionForm" method="post" action="{{ url_for('admin_elections') }}" class="modal-form">
                            <input type="hidden" id="election_id" name="election_id" value="">
                            <div class="form-row">
                                <label for="title">Election Title</label>
                                <input type="text" id="title" name="title" required placeholder="Enter election title">
                            </div>
                            <div class="form-row">
                                <label for="description">Description</label>
                                <textarea id="description" name="description" rows="4" placeholder="Describe the election (optional)"></textarea>
                            </div>
                            <div class="form-row split">
                                <div>
                                    <label for="start_date">Start Date</label>
                                    <input type="date" id="start_date" name="start_date" required>
                                </div>
                                <div>
                                    <label for="end_date">End Date</label>
                                    <input type="date" id="end_date" name="end_date" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <label for="positions">Position(s) / Category</label>
                                <input type="text" id="positions" name="positions" placeholder="e.g., President, Vice President or 'All'">
                            </div>
                            <div class="form-row">
                                <label for="status">Status</label>
                                <select id="status" name="status">
                                    <option value="Draft">Draft</option>
                                    <option value="Active">Active</option>
                                    <option value="Completed">Completed</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                                <button type="submit" class="btn btn-primary">Create Election</button>
                            </div>
                        </form>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name of Election</th>
                            <th>Status</th>
                            <th>Date/Time Start</th>
                            <th>Date/Time End</th>
                            <th class="actions-col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if elections and elections|length > 0 %}
                            {% for e in elections %}
                                <tr>
                                    <td>{{ e.title }}</td>
                                    <td>{{ e.status }}</td>
                                    <td>{{ e.start_date.strftime('%Y-%m-%d') }}</td>
                                    <td>{{ e.end_date.strftime('%Y-%m-%d') }}</td>
                                    <td class="actions-col">
                                        <a href="#" class="btn-edit" data-id="{{ e.id }}" data-title="{{ e.title|e }}" data-description="{{ e.description|e if e.description else '' }}" data-start="{{ e.start_date.isoformat() }}" data-end="{{ e.end_date.isoformat() }}" data-positions="{{ e.positions|e if e.positions else '' }}" data-status="{{ e.status }}" style="padding:6px 10px; background:#ffc107; color:#000; text-decoration:none; border-radius:5px; margin-right:6px;">Edit</a>
                                        <a href="#" class="btn-delete" data-id="{{ e.id }}" style="padding:6px 10px; background:#dc3545; color:#fff; text-decoration:none; border-radius:5px;">Delete</a>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5">There are currently no active elections. Please check back later.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal" aria-hidden="true">
    <div class="modal-overlay" data-close-delete></div>
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="deleteModalTitle">
        <header class="modal-header">
            <h2 id="deleteModalTitle">Confirm Delete</h2>
            <button class="close-btn" id="closeDeleteModalBtn" aria-label="Close modal">&times;</button>
        </header>
        <p>Are you sure you want to delete this election? This action cannot be undone.</p>
        <form id="deleteForm" method="post" action="{{ url_for('admin_delete_election') }}" style="margin-top:12px; display:flex; justify-content:flex-end; gap:8px;">
            <input type="hidden" id="delete_election_id" name="election_id" value="">
            <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
            <button type="submit" class="btn btn-primary" style="background:#dc3545;">Delete</button>
        </form>
    </div>
</div>
<script>
    (function () {
        const openBtn = document.getElementById('openModalBtn');
        const modal = document.getElementById('electionModal');
        const closeBtn = document.getElementById('closeModalBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const overlay = document.querySelector('#electionModal .modal-overlay');
    const form = document.getElementById('electionForm');
    const electionIdInput = document.getElementById('election_id');
    const modalTitle = document.getElementById('modalTitle');

        function showModal() {
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            // focus the first input
            setTimeout(() => document.getElementById('title').focus(), 50);
        }

        function hideModal() {
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        openBtn && openBtn.addEventListener('click', showModal);
        closeBtn && closeBtn.addEventListener('click', hideModal);
        cancelBtn && cancelBtn.addEventListener('click', hideModal);
        overlay && overlay.addEventListener('click', hideModal);

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && modal.getAttribute('aria-hidden') === 'false') {
                hideModal();
            }
        });

    form && form.addEventListener('submit', function (e) {
            // Basic client-side validation: ensure dates are ordered
            const start = document.getElementById('start_date').value;
            const end = document.getElementById('end_date').value;
            if (start && end && start > end) {
                e.preventDefault();
                alert('End Date must be the same or after Start Date.');
                return false;
            }
            // Allow normal form submission; backend should handle saving.
            // Optional: add a small loading state
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Creating...';
            }
        });

        // Edit handler: populate modal with election data
        document.querySelectorAll('.btn-edit').forEach(function (btn) {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                const id = this.getAttribute('data-id');
                const title = this.getAttribute('data-title') || '';
                const description = this.getAttribute('data-description') || '';
                const start = this.getAttribute('data-start') || '';
                const end = this.getAttribute('data-end') || '';
                const positions = this.getAttribute('data-positions') || '';
                const status = this.getAttribute('data-status') || 'Draft';

                electionIdInput.value = id;
                document.getElementById('title').value = title;
                document.getElementById('description').value = description;
                document.getElementById('start_date').value = start;
                document.getElementById('end_date').value = end;
                document.getElementById('positions').value = positions;
                document.getElementById('status').value = status;

                modalTitle.textContent = 'Edit Election';
                const submitBtn = form.querySelector('button[type="submit"]');
                if (submitBtn) submitBtn.textContent = 'Save Changes';
                showModal();
            });
        });

        // Delete modal handlers
        const deleteModal = document.getElementById('deleteModal');
        const deleteOverlay = document.querySelector('#deleteModal .modal-overlay');
        const closeDeleteBtn = document.getElementById('closeDeleteModalBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const deleteIdInput = document.getElementById('delete_election_id');

        function showDeleteModal() {
            deleteModal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
        }
        function hideDeleteModal() {
            deleteModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
            deleteIdInput.value = '';
        }

        document.querySelectorAll('.btn-delete').forEach(function (btn) {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                const id = this.getAttribute('data-id');
                if (!id) return;
                deleteIdInput.value = id;
                showDeleteModal();
            });
        });

        deleteOverlay && deleteOverlay.addEventListener('click', hideDeleteModal);
        closeDeleteBtn && closeDeleteBtn.addEventListener('click', hideDeleteModal);
        cancelDeleteBtn && cancelDeleteBtn.addEventListener('click', hideDeleteModal);
    })();
</script>
</html>